<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CDN Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha256-MBffSnbbXwHCuZtgPYiwMQbfE7z+GOZ7fBPCNB06Z98=" crossorigin="anonymous">
</head>

<body>
    <header>
        <nav class="navbar border-bottom navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="https://github.com/dnd-mdn">dnd-mdn</a>
            </div>
        </nav>
    </header>
    <main>
        <div class="container my-2">
            <h1 class="h3 mt-4">CDN Tools</h1>
            <p class="lead">Test</p>

            <ul id="list"></ul>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js" integrity="sha384-5AkRS45j4ukf+JbWAfHL8P4onPA9p0KwwP7pUdjSQA3ss9edbJUJc/XcYAiheSSz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha256-gvZPYrsDwbwYJLD5yeBfcNujPhRoGOY831wwbIzz3t0=" crossorigin="anonymous"></script>

    <script type="module">
        import { Octokit } from "https://esm.sh/@octokit/rest"

        const octokit = new Octokit()

        const $list = $('#list')

        async function content(dir) {
            // Get directory
            const content = await octokit.repos.getContent({
                owner: 'dnd-mdn',
                repo: 'cdn',
                dir: dir
            })

            // Ignore .md files
            return content.data.filter(node => {
                return !node.name.endsWith('.md') && node.name !== 'LICENSE'
            })
        }

        
        content('programs').then(list => {
            list.forEach(node => {

                if (node.type === 'dir') {
                    $list.append(`<li>${node.path}</li>`)
                } else {
                    $list.append(`<li>${node.path}</li>`)
                }
                
            })

        })
        


        async function purge(path) {
            const url = `https://purge.jsdelivr.net/gh/dnd-mdn/cdn@latest/${path}`
            const response = await fetch(url)
            const data = await response.json()

            if (data.status !== 'finished') {
                throw new Error('Unable to clear cache')
            }
        }


    </script>


</body>

</html>